프로젝트 소개  
=============
#### SpringBoot + ReactJS 포트폴리오 관리 앱
#### 실행 영상: https://youtu.be/eUJHDjgg1hA
 

설명
====
### 1. 개발환경  
* Language: Java, JavaScript
* backend: SpringBoot_ver_2.0  
* frontdne: ReactJs  
* security: SpringSecutiry, JwtTokenLogin(RefreshToken을 이용하여 이중 보안)  
* DataBase: MySQL_ver_8.0.17  
* 기타 라이브러리: AntDesign, JPA-Hibernate  

### 2. 개발기간
* 약 4주(2020.05.15~2020.06.16)

### 3. 개발인원
* 1명(본인) 개인 프로젝트  

### 4. 기획 의도 및 설명  
   *프로젝트 진행 목록을 보기 좋게 포트폴리오 형식으로 웹에 업로드 하려고 
    찾아보다 마땅한 사이트가 없어 내가 원하는 스타일대로 집적 기획, 제작 하게 되었다.
    백엔드는 SpringBoot, 프론트엔드는 ReactJS를 사용하였으며 RestAPI방식으로 구현하려 노력하였다.
    개발을 진행하다 막히는 부분이 생기면 구글링과 개발자 커뮤니티, 지인에게 자문을 구해 해결하였다.
  
### 5. 동작 설명
   * 기능별 상세 설명은 실행 영상 참조-> https://youtu.be/eUJHDjgg1hA

### 6. 기능

   * 회원 관련
     회원은 게스트(단순 방문자), 일반유저, 일반관리자, 최고관리자로 나뉘며 
     로그인 처리 방식은 세션로그인 방식이 아닌 JWT토큰 로그인 방식을 사용한다.
     로그인에 사용되는 accessToken은 40분으로 정했으며, accessToken의 유효기간이 
     5 분 미만으로 남으면 refreshToken을 이용해 최대 2주동안 accessToken을 자동 갱신 한다.

   * 관리자
    관리자 권한은 최고관리자, 일반관리자로 나뉜다. 최고관리자는 관리자의 권한을 부여, 회수 할 수 있다. 
    이 외의 관리자 기능은 최고관리자와 일반 관리자가 동일하다. 관리자의 공통된 기능으로는 유저 계정 활성화, 
    비활성화가 있으며 본인이나 본인보다 권한이 높은 관리자에 대한 권한은 컨트롤 할 수 없다.
    또한 관리자는 유저의 포트폴리오에 대하여 삭제, 비활성화 처리를 할 수 있다.

   * 포트폴리오 
    포트폴리오를 구간별로 Header, About, Portfolio, Skill, PortfolioPDF로 나눠 각 기능별 구현을 하였다. 
    각 기능의 생성, 수정, 삭제는 상호 독립적으로 동작하지만 Header를 먼저 업로드 해야만 
    About, Portfolio, Skill, PortfolioPDF를 업로드 할 수 있다.
    또한 header테이블과 연관관계를 맺는 하위 테이블인 portfolio_like테이블을 만들어 header를 기반으로 
    portfolio에 대한 추천 기능을 구현하였다. 이 역시 header가 먼저 구현되어야 사용할 수 있는 기능이다. 
    포트폴리오 전체 삭제기능도 header가 존재해야 활성화 되는 기능이며 Header, About, Portfolio, Skill, 
    PortfolioPDF등 해당 유저의 모든 포트폴리오 데이터를 삭제한다.

   * UI
    우측 슬라이드 바에 각종 기능으로 이어지는 버튼을 배치해 권한, 페이지위치에 따라 필요한 버튼을 
    동적으로 변화하여 배치되게 구현했다
    또한 검색기능을 통해 회원의 포트폴리오를 검색하여 조회 할 수 있다.
  
   * 로깅
    모든 Http요청에 대한 로그가 기록되며 get요청은 성공시에만 로그가 기록되고, 
    post, put, delete 로그는 input데이터를 포함한 request와, 성공 유무인 response 로그가 기록된다.  
    회원가입, 로그인, 로그아웃, 토큰갱신 요청에 관련한 로그는 따로 기록되어진다. 
    로그 기록 양식은 한눈에 읽기 쉽게 육하원칙에 의거하여 구현을 하였으며 각 로그는 
    12자리 난수 번호를 기본키의 값으로 갖는다. 로그 관리 방식은 클래스마다 일일이 수동으로 
    기록하지 않고 모든 요청에 대해 각 요청별로 뷴류하여 통합적으로 자동으로 기록되도록 구현 하였다. 
    개발시 인터셉터를 이용한 방식과, aop를 이용한 방식 두가지 방식을 구현하였으며 
    최종적으로 aop를 이용한 방식을 선택하여 사용하였다.

   * 에러처리
    에러처리는 RestControllerAdvice를 통해 컨트롤러 단에서 발생한 예외에 관하여 전역으로 예외를 
    catch하며 혹여나 발생할 수 있는 예측이 불가능한 예외는 ExceptionHandler를 통해 
    에러 로그를 기록하고 “error” message를 반환한다. 예측이 가능한 예외는 경우별로 
    예외 클래스를 생성하여 에러 로그를 기록하고 프론트 단으로 적절한 상태코드와 해당 
    예외와 관련한 message를 반환하도록 하였으며 프론트단 에서는 받은 message를 이용하여 예외처리를 한다. 
    예외처리 방식의 핵심은 예외를 catch하고 프론트단으로 적절한 에러 상태코드와 message를 반환해 주는 것이다. 
    프론트단에서는 성공 상태코드를 return 받아야만 정상적인 동작을 수행하며 에러 상태코드를 return 받으면 
    함께 전송된 message가 있을 경우(예측 가능한 예외의 경우)
    해당 메시지를 모달 컴포넌트를 이용해 띄워주거나
    전송된 message가 “null”이거나 “error”인 경우(예측 불가능한 예외의 경우)
    “요청 수행중 문제가 발생하였습니다” 문구를 모달 컴포넌트를 이용해 띄워준다.



### 7. JWT Token 관련  
* jwt토큰 로그인  
  * AccessToken: 유효기간 40분  
  * RefreshToken: 유효기간 2주  
  * 토큰 저장공간: SessionStorage  
  * 토큰 관리: 서버측에서의 토큰 관리는 refresh_token테이블과 token_blacklist테이블에 넣어서 관리  

* 설명  
   * 엑세스토큰은 매 요청시 request header에 포함하여 서버측으로 전송,  
   서버측에서 유효성 검사 후 문제가 없다면 요청 수행 만료되었거나 변조되었다면 error message return   
   리프레시토큰은 단순히 엑세스토큰을 재발급 받는 key이다.  

   * 로그인 -> db의 리프레시 토큰 테이블에 토큰 정보 저장&&갱신(기존값이 있다면 지우고 새로운 값 덮어쓰기)  
   * 로그아웃 -> db에 리프레시토큰 테이블의 토큰을 지우고 블랙리스트 테이블에 리프레시토큰 추가  

   * 엑세스토큰을 발급받는 컨트롤러에서 리프레시토큰이  
   위, 변조되지 않았고 유효기한이 만료되지 않았으며 블랙리스트 테이블에 존재하지 않아야 한다는  
   조건문을 통과해야 엑세스토큰이 새로 발급 됨.  
   이 경우를 제외하고 전부 로그아웃 처리  

* 부가설명  
   * 클라이언트 측에서의 토큰 저장공간에 대하여  
   SessionStorage는 브라우저를 종료하거나 탭을 닫으면 값이 초기화됨  
   LocalStorage는 브라우저를 종료하거나 탭을 닫아도 값이 반영구적으로 유지됨  
   Token로그인 방식의 특성상 토큰이 탈취되는 등 보안성 측면에서 고질적인 이슈가 있기에  
   SessionStorage 사용이 보안적인 측면에서 더 좋은 방안인것 같음.  

* 서비스를 이용하다 엑세스 토큰 만료 상황 발생 시뮬레이션  

   -> 클라이언트측에서 엑세스 토큰의 유효기한을 검증 후  
      5분 이내로 남았다면 서버로 리프레시 토큰을 보내 로그인 갱신 요청을 보냄
      
   -> 서버측에서는 requestBody에 담겨져 넘어온 리프레시토큰을 이용하여 엑세스 토큰을 발급 받는다  
       서버측 리프레시 토큰 발급 과정  
       *3단계의 조건 검사가 진행되며 각 조건문을 통과하지 못할시 error message return와 함께 즉시 로그아웃 처리
       
       1. 파라미터값으로 넘어온 토큰이 db의 리프레시토큰 테이블에 존재하고  
           블랙리스트 테이블에 존재하지 않는지 확인 두 조건을 통과해야 다음단계로 넘어감.  
       2. 위의 조건을 통과했다면 리프레시토큰이 만료되거나 변조된것은 아닌지 유효성 검사 실행  
          유효성 검사를 통과하면 user정보의 기본키인 userid를 반환  
       3. userid로 user테이블에 쿼리를 날려 username을 가져옴  
       4. username을 가지고 새로운 엑세스 토큰을 발급하여 기존의   
          리프레시 토큰과 함께 클라이언트 측으로 response를 보낸다.  
          
   -> 위의 과정 통과 시 클라이언트측은 서버측으로부터 success message와 함께 리프레시 토큰과 엑세스 토큰을  
      넘겨받게 되며 리프레시토큰과 엑세스토큰을 SessionStorage에 저장하고 로그인을 유지한다.


실행 방법  
========
  * Backend  
     a. application.properties 의 DB연동 설정을 참고하여 DB생성  
     b. 이클립스 사용  
         
         portfolio_backend
         -> 프로젝트 마우스 우클릭   
         -> Run As  
         -> Spring Boot App 클릭  

   * Frontend  
      a. VSCode사용  

         portfolio_frontend
         -> yarn start && npm start  


### 기능별 상세 설명은 실행 영상 참조: https://youtu.be/eUJHDjgg1hA
